---
import { Image } from 'astro:assets';

interface Props {
  image?: ImageMetadata;
  title: string;
  subtitle?: string;
  overlayOpacity?: number;
  showCountdown?: boolean;
}

const {
  image,
  title,
  subtitle,
  overlayOpacity = 0.6,
  showCountdown = false
} = Astro.props;

// Get event date for countdown
import { getSetting } from '../lib/db';
const eventDateStart = getSetting('event_date_start') || '2026-07-01';
---

<section class="relative overflow-hidden">
  <!-- Background Image (if provided) -->
  {image && (
    <div class="absolute inset-0 z-0 bg-primary-700">
      <div id="hero-image-container" class="hero-image-container opacity-0 transition-opacity duration-300 ease-in-out">
        <Image
          src={image}
          alt={title}
          class="w-full h-full object-cover object-[center_10%]"
          widths={[640, 1024, 1536]}
          sizes="100vw"
          loading="eager"
          fetchpriority="high"
          decoding="sync"
        />
      </div>
      {/* Dark overlay for text readability */}
      <div
        class="absolute inset-0 bg-black"
        style={`opacity: ${overlayOpacity}`}
      ></div>
    </div>
  )}

  <!-- Gradient fallback if no image -->
  {!image && (
    <div class="absolute inset-0 z-0 bg-gradient-to-r from-primary-600 to-primary-800"></div>
  )}

  <!-- Content -->
  <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 md:py-32">
    <div class="text-center text-white">
      <h1 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-lg">
        {title}
      </h1>
      {subtitle && (
        <p class="text-xl md:text-2xl text-white text-opacity-90 mb-8 drop-shadow">
          {subtitle}
        </p>
      )}

      <!-- Countdown Timer -->
      {showCountdown && (
        <div id="countdown-timer" class="mt-8 flex justify-center gap-4 md:gap-8">
          <div class="text-center">
            <div id="days" class="text-4xl md:text-6xl font-bold text-primary-400">00</div>
            <div class="text-sm md:text-base text-accent-400 font-semibold mt-1">DAYS</div>
          </div>
          <div class="text-center">
            <div id="hours" class="text-4xl md:text-6xl font-bold text-primary-400">00</div>
            <div class="text-sm md:text-base text-accent-400 font-semibold mt-1">HRS</div>
          </div>
          <div class="text-center">
            <div id="minutes" class="text-4xl md:text-6xl font-bold text-primary-400">00</div>
            <div class="text-sm md:text-base text-accent-400 font-semibold mt-1">MIN</div>
          </div>
          <div class="text-center">
            <div id="seconds" class="text-4xl md:text-6xl font-bold text-primary-400">00</div>
            <div class="text-sm md:text-base text-accent-400 font-semibold mt-1">SEC</div>
          </div>
        </div>
      )}

      <!-- Slot for additional content (CTAs, etc.) -->
      <div class="mt-8">
        <slot />
      </div>
    </div>
  </div>
</section>

<script>
  // Show hero image immediately on load
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('hero-image-container');
    if (container) {
      // Force immediate display - remove opacity transition delay
      requestAnimationFrame(() => {
        container.classList.remove('opacity-0');
        container.classList.add('opacity-100');
      });
    }
  });
</script>

{showCountdown && <script define:vars={{ eventDateStart }} is:inline>
  function updateCountdown() {
    const eventDate = new Date(eventDateStart + 'T00:00:00').getTime();
    const now = new Date().getTime();
    const distance = eventDate - now;

    if (distance < 0) {
      document.getElementById('countdown-timer')?.classList.add('hidden');
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    const daysEl = document.getElementById('days');
    const hoursEl = document.getElementById('hours');
    const minutesEl = document.getElementById('minutes');
    const secondsEl = document.getElementById('seconds');

    if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
    if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
    if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
    if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
  }

  // Update immediately and then every second
  updateCountdown();
  setInterval(updateCountdown, 1000);
</script>}
